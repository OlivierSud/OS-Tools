<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Outils hors ligne</title>
  <style>
    body { margin:0; display:flex; height:100vh; font-family:sans-serif; }
    #sidebar { width:300px; background: linear-gradient(135deg, #0b1c2c, #0e1d39);; color:#eaf5fe; padding:20px;
               display:flex; flex-direction:column; }
    #sidebar h2 { margin:0; font-size:18px; text-align:center; display:flex; justify-content:space-between; align-items:center; }
    #refresh { background: linear-gradient(135deg, #2360a1, #205590); color:#ffffff; border:none; padding:4px 8px; border-radius:5px; cursor:pointer; }
    #list { list-style:none; padding:0; margin:10px 0 0; flex:1; overflow:auto; }
    #list li { margin:6px 0; }
    #list a { display:block; padding:6px 10px; color:#ffffff; text-decoration:none; border-radius:5px; }
    #list a:hover { background:#34495e; }
    #list a.active { background:#1abc9c; }
    
    .folder { background: rgba(255,255,255,0.1); border-radius:5px; margin:6px 0; }
    .folder-header { display:flex; justify-content:space-between; align-items:center; padding:8px 10px; }
    .folder-name { font-weight:bold; color:#5ec1ff; }
    
    #content { flex:1; position:relative; }
    #placeholder { position:absolute; inset:0; background:#000; }
    iframe { position:absolute; inset:0; width:100%; height:100%; border:0; display:none; }
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>
      Outils
      <button id="refresh"> Actualiser ⟳</button>
    </h2>
    <ul id="list"></ul>
  </div>

  <div id="content">
    <div id="placeholder"></div>
    <iframe id="viewer"></iframe>
  </div>

  <script>
    const list = document.getElementById('list');
    const viewer = document.getElementById('viewer');
    const placeholder = document.getElementById('placeholder');
    const refreshBtn = document.getElementById('refresh');

    let folders = {};
    let tools = [];

    // Fonction pour organiser automatiquement les outils par arborescence
    function organizeToolsByStructure(tools) {
      // Réinitialiser les dossiers existants
      folders = {};
      
      tools.forEach(tool => {
        // Extraire le préfixe de catégorie (ex: "2D", "3D", "Video")
        const category = extractCategory(tool.name);
        
        if (category) {
          // Créer le dossier s'il n'existe pas
          if (!folders[category]) {
            folders[category] = {
              name: category,
              tools: []
            };
          }
          
          // Ajouter l'outil au dossier
          folders[category].tools.push(tool.name);
        }
      });
    }

    // Fonction pour extraire la catégorie d'un nom d'outil
    function extractCategory(toolName) {
      // Nouveau format : on prend le préfixe avant le premier tiret
      const match = toolName.match(/^([^-]+)-/);
      if (match) {
        // Nettoyage d'éventuels espaces ou majuscules
        return match[1].trim().replace(/^[a-z]/, c => c.toUpperCase());
      }
      return null;
    }

    // Fonction pour scanner automatiquement le dossier Outils
    async function scanOutilsFolder() {
      try {
        // Utiliser l'API File System Access si disponible
        if ('showDirectoryPicker' in window) {
          const dirHandle = await window.showDirectoryPicker({
            startIn: 'Outils'
          });
          const files = [];
          
          for await (const entry of dirHandle.values()) {
            if (entry.kind === 'file' && entry.name.endsWith('.html')) {
              const file = await entry.getFile();
              files.push(file);
            }
          }
          
          tools = files;
          organizeToolsByStructure(tools);
          renderList();
        } else {
          // Fallback pour les navigateurs qui ne supportent pas l'API File System Access
          const staticFiles = [
            { name: '2D-GIF-creator.html', path: './Outils/2D-GIF-creator.html' },
            { name: '2D-Sprite-sheet-cutter.html', path: './Outils/2D-Sprite-sheet-cutter.html' },
            { name: '2D-svg-remove-color.html', path: './Outils/2D-svg-remove-color.html' },
            { name: '2D-Remove-color-as-alpha.html', path: './Outils/2D-Remove-color-as-alpha.html' },
            { name: '2D-color-replacement.html', path: './Outils/2D-color-replacement.html' },
            { name: '3D-Json-to-GLTF.html', path: './Outils/3D-Json-to-GLTF.html' },
            { name: 'Video-Timelaps-to-MP4.html', path: './Outils/Video-Timelaps-to-MP4.html' }
          ];
          
          tools = staticFiles;
          organizeToolsByStructure(tools);
          renderList();
        }
      } catch (error) {
        console.error('Erreur lors du scan du dossier:', error);
        // En cas d'erreur, utiliser la liste statique
        const staticFiles = [
          { name: '2D-GIF-creator.html', path: './Outils/2D-GIF-creator.html' },
          { name: '2D-Sprite-sheet-cutter.html', path: './Outils/2D-Sprite-sheet-cutter.html' },
          { name: '2D-svg-remove-color.html', path: './Outils/2D-svg-remove-color.html' },
          { name: '2D-Remove-color-as-alpha.html', path: './Outils/2D-Remove-color-as-alpha.html' },
          { name: '2D-color-replacement.html', path: './Outils/2D-color-replacement.html' },
          { name: '3D-Json-to-GLTF.html', path: './Outils/3D-Json-to-GLTF.html' },
          { name: 'Video-Timelaps-to-MP4.html', path: './Outils/Video-Timelaps-to-MP4.html' }
        ];
        
        tools = staticFiles;
        organizeToolsByStructure(tools);
        renderList();
      }
    }

    // Fonction pour rendre la liste
    function renderList() {
      list.innerHTML = '';
      
      // Rendre les dossiers
      Object.keys(folders).forEach(folderId => {
        const folder = folders[folderId];
        const li = document.createElement('li');
        li.className = 'folder';
        
        const folderHeader = document.createElement('div');
        folderHeader.className = 'folder-header';
        
        const folderName = document.createElement('span');
        folderName.className = 'folder-name';
        folderName.textContent = folder.name;
        
        folderHeader.appendChild(folderName);
        
        const folderContent = document.createElement('div');
        folderContent.className = 'folder-content';
        folderContent.style.paddingLeft = '15px';
        
        // Ajouter les outils du dossier
        folder.tools.forEach(toolName => {
          const tool = tools.find(t => t.name === toolName);
          if (tool) {
            const toolLi = createToolElement(tool);
            folderContent.appendChild(toolLi);
          }
        });
        
        li.appendChild(folderHeader);
        li.appendChild(folderContent);
        list.appendChild(li);
      });
      
      // Rendre les outils non classés
      const unassignedTools = tools.filter(tool => {
        return !Object.values(folders).some(folder => 
          folder.tools.includes(tool.name)
        );
      });
      
      if (unassignedTools.length > 0) {
        const unassignedHeader = document.createElement('li');
        unassignedHeader.innerHTML = '<div style="padding:8px 10px; color:#ccc; font-style:italic;">Outils non classés</div>';
        list.appendChild(unassignedHeader);
        
        unassignedTools.forEach(tool => {
          const toolLi = createToolElement(tool);
          list.appendChild(toolLi);
        });
      }
    }

    // Fonction pour créer un élément outil
    function createToolElement(tool) {
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.textContent = tool.name.replace(/\.html?$/i, '');
      
      if (tool.path) {
        a.href = tool.path;
      } else {
        a.href = URL.createObjectURL(tool);
      }
      
      a.addEventListener('click', e => {
        e.preventDefault();
        list.querySelectorAll('a').forEach(l => l.classList.remove('active'));
        a.classList.add('active');
        viewer.src = a.href;
        viewer.style.display = 'block';
        placeholder.style.display = 'none';
      });
      
      li.appendChild(a);
      return li;
    }

    // Événements
    refreshBtn.addEventListener('click', () => {
      scanOutilsFolder();
    });

    // Scanner automatiquement au chargement de la page
    document.addEventListener('DOMContentLoaded', () => {
      scanOutilsFolder();
    });
  </script>
</body>
</html>